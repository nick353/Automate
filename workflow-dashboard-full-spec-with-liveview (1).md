# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰é–‹ç™ºæŒ‡ç¤ºæ›¸ï¼ˆå®Œå…¨ç‰ˆ + ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼ï¼‰

ã‚ãªãŸã¯ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯é–‹ç™ºã®å°‚é–€å®¶ã§ã™ã€‚ä»¥ä¸‹ã®ä»•æ§˜ã«å¾“ã£ã¦ã€Browser Useã‚’ä½¿ã£ãŸè‡ªç„¶è¨€èªAIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç®¡ç†ãƒ»å¯è¦–åŒ–ã™ã‚‹Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ã¦ãã ã•ã„ã€‚

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### ç›®çš„
è‡ªç„¶è¨€èªã§æŒ‡ç¤ºã—ãŸãƒ–ãƒ©ã‚¦ã‚¶è‡ªå‹•åŒ–ã‚¿ã‚¹ã‚¯ã‚’ã€Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰ç®¡ç†ãƒ»ç›£è¦–ãƒ»å®Ÿè¡Œã§ãã‚‹ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚**å‹•ç”»ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦AIã«åˆ†æã•ã›ã€ãƒãƒ£ãƒƒãƒˆã§ãƒ’ã‚¢ãƒªãƒ³ã‚°ã—ãªãŒã‚‰ã‚¿ã‚¹ã‚¯ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹æ©Ÿèƒ½**ã‚‚æ­è¼‰ã™ã‚‹ã€‚**n8nã®ã‚ˆã†ã«APIã‚­ãƒ¼ã‚„ã‚µã‚¤ãƒˆãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’å®‰å…¨ã«ä¿å­˜ãƒ»ç®¡ç†ã—ã€ç¹°ã‚Šè¿”ã—åˆ©ç”¨ã§ãã‚‹æ©Ÿèƒ½**ã‚‚å®Ÿè£…ã™ã‚‹ã€‚

### ä¸»è¦æ©Ÿèƒ½
1. **å‹•ç”»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ + AIåˆ†æ**ï¼ˆGemini 1.5 Proï¼‰
2. **AIãƒãƒ£ãƒƒãƒˆã«ã‚ˆã‚‹ãƒ’ã‚¢ãƒªãƒ³ã‚°**ï¼ˆä¸æ˜ç‚¹ã®ç¢ºèªï¼‰
3. **ã‚¿ã‚¹ã‚¯è‡ªå‹•ç”Ÿæˆ**ï¼ˆãƒãƒ£ãƒƒãƒˆçµæœã‹ã‚‰ã‚¿ã‚¹ã‚¯ä½œæˆï¼‰
4. **èªè¨¼æƒ…å ±ç®¡ç†ï¼ˆCredentialsï¼‰**
   - APIã‚­ãƒ¼ã®ä¿å­˜ï¼ˆAnthropicã€Googleã€Slackãªã©ï¼‰
   - ã‚µã‚¤ãƒˆãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã®ä¿å­˜ï¼ˆæš—å·åŒ–ï¼‰
   - ã‚¿ã‚¹ã‚¯ä½œæˆæ™‚ã«ä¿å­˜æ¸ˆã¿èªè¨¼æƒ…å ±ã‚’é¸æŠ
5. **ğŸ†• ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ï¼ˆManusåŒç­‰ï¼‰**
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒƒãƒ—é€²æ—è¡¨ç¤º
   - ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®ãƒ©ã‚¤ãƒ–æ›´æ–°
   - ä¸€æ™‚åœæ­¢ãƒ»å†é–‹ãƒ»åœæ­¢ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
   - VNCé¢¨ã®ãƒ–ãƒ©ã‚¦ã‚¶ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼
   - ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã®æ‰€è¦æ™‚é–“è¡¨ç¤º
6. ã‚¿ã‚¹ã‚¯ä¸€è¦§è¡¨ç¤ºï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ä»˜ãï¼‰
7. å®Ÿè¡Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤ºï¼ˆæˆåŠŸ/å¤±æ•—/å®Ÿè¡Œä¸­ï¼‰
8. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°è¡¨ç¤º
9. ã‚¿ã‚¹ã‚¯ã®è¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤ï¼ˆCRUDï¼‰
10. æ‰‹å‹•å®Ÿè¡Œãƒœã‚¿ãƒ³
11. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®šï¼ˆGUIã€cronå½¢å¼ï¼‰
12. å®Ÿè¡Œå±¥æ­´ã®é–²è¦§
13. ã‚¨ãƒ©ãƒ¼é€šçŸ¥è¨­å®šï¼ˆSlack/ãƒ¡ãƒ¼ãƒ«ï¼‰
14. çµæœãƒ‡ãƒ¼ã‚¿ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

### ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆ
Hetzner VPS + Coolifyï¼ˆæ¨å¥¨ï¼šæœˆé¡$7ã€œ10ï¼‰
ã¾ãŸã¯ Railway / Fly.io / Google Cloud Run

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **è¨€èª**: Python 3.11+
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: FastAPI
- **ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©**: APScheduler
- **WebSocket**: fastapi-websocket
- **DB**: SQLiteï¼ˆSQLAlchemy ORMï¼‰â†’ SaaSå±•é–‹æ™‚ã¯PostgreSQL
- **ãƒ–ãƒ©ã‚¦ã‚¶è‡ªå‹•åŒ–**: browser-use + langchain-anthropic
- **å‹•ç”»åˆ†æ**: Google Gemini 1.5 Pro API
- **æš—å·åŒ–**: cryptography (Fernet + PBKDF2)
- **ãã®ä»–**: python-dotenv, aiofiles, google-generativeai

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: React 18+ (Vite)
- **ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°**: Tailwind CSS
- **çŠ¶æ…‹ç®¡ç†**: Zustand
- **HTTPé€šä¿¡**: Axios
- **WebSocket**: native WebSocket API
- **UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**: shadcn/ui

### ã‚¤ãƒ³ãƒ•ãƒ©
- **ã‚³ãƒ³ãƒ†ãƒŠ**: Docker + Docker Compose
- **ãƒ‡ãƒ—ãƒ­ã‚¤**: Hetzner + Coolifyï¼ˆæ¨å¥¨ï¼‰

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
workflow-dashboard/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py              # FastAPIã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ config.py            # è¨­å®šç®¡ç†
â”‚   â”‚   â”œâ”€â”€ database.py          # DBæ¥ç¶šãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³
â”‚   â”‚   â”œâ”€â”€ models.py            # SQLAlchemyãƒ¢ãƒ‡ãƒ«
â”‚   â”‚   â”œâ”€â”€ schemas.py           # Pydanticã‚¹ã‚­ãƒ¼ãƒ
â”‚   â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ tasks.py         # ã‚¿ã‚¹ã‚¯CRUD API
â”‚   â”‚   â”‚   â”œâ”€â”€ executions.py    # å®Ÿè¡Œå±¥æ­´API
â”‚   â”‚   â”‚   â”œâ”€â”€ scheduler.py     # ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«API
â”‚   â”‚   â”‚   â”œâ”€â”€ wizard.py        # ã‚¿ã‚¹ã‚¯ä½œæˆã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰API
â”‚   â”‚   â”‚   â”œâ”€â”€ credentials.py   # èªè¨¼æƒ…å ±ç®¡ç†API
â”‚   â”‚   â”‚   â”œâ”€â”€ settings.py      # ã‚·ã‚¹ãƒ†ãƒ è¨­å®šAPI
â”‚   â”‚   â”‚   â”œâ”€â”€ live_view.py     # ğŸ†• ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼API
â”‚   â”‚   â”‚   â””â”€â”€ websocket.py     # WebSocket
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ agent.py         # Browser Useå®Ÿè¡Œ
â”‚   â”‚   â”‚   â”œâ”€â”€ scheduler.py     # APSchedulerã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ notifier.py      # é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ video_analyzer.py    # å‹•ç”»åˆ†æã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ wizard_chat.py       # ãƒ’ã‚¢ãƒªãƒ³ã‚°ãƒãƒ£ãƒƒãƒˆã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ credential_manager.py  # èªè¨¼æƒ…å ±ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ encryption.py        # æš—å·åŒ–ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ live_view_manager.py # ğŸ†• ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ browser_controller.py # ğŸ†• ãƒ–ãƒ©ã‚¦ã‚¶åˆ¶å¾¡ï¼ˆä¸€æ™‚åœæ­¢ç­‰ï¼‰
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â””â”€â”€ logger.py        # ãƒ­ã‚®ãƒ³ã‚°
â”‚   â”œâ”€â”€ uploads/                 # ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ä¸€æ™‚ä¿å­˜
â”‚   â”œâ”€â”€ screenshots/             # ğŸ†• ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆä¿å­˜
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ .env.example
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.jsx
â”‚   â”‚   â”œâ”€â”€ App.jsx
â”‚   â”‚   â”œâ”€â”€ index.css
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ Layout.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ TaskList.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ TaskCard.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ TaskForm.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ExecutionLog.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ScheduleEditor.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ HistoryTable.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ StatusBadge.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ VideoUploader.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ WizardChat.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ TaskPreview.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ CredentialForm.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ CredentialList.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ CredentialSelector.jsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   # ğŸ†• ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼é–¢é€£
â”‚   â”‚   â”‚   â”œâ”€â”€ LiveView/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ index.jsx            # ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ StepProgress.jsx     # ã‚¹ãƒ†ãƒƒãƒ—é€²æ—è¡¨ç¤º
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ScreenshotViewer.jsx # ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆè¡¨ç¤º
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ControlPanel.jsx     # ä¸€æ™‚åœæ­¢/åœæ­¢ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LogStream.jsx        # ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ BrowserPreview.jsx   # VNCé¢¨ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ ExecutionViewer.jsx      # ğŸ†• å®Ÿè¡Œè©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Tasks.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ TaskWizard.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ History.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Credentials.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Settings.jsx
â”‚   â”‚   â”‚   â””â”€â”€ Execution.jsx            # ğŸ†• å®Ÿè¡Œè©³ç´°ãƒšãƒ¼ã‚¸
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useWebSocket.js
â”‚   â”‚   â”‚   â”œâ”€â”€ useTasks.js
â”‚   â”‚   â”‚   â”œâ”€â”€ useExecutions.js
â”‚   â”‚   â”‚   â”œâ”€â”€ useWizardChat.js
â”‚   â”‚   â”‚   â”œâ”€â”€ useCredentials.js
â”‚   â”‚   â”‚   â””â”€â”€ useLiveView.js           # ğŸ†• ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼ç”¨ãƒ•ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â””â”€â”€ api.js
â”‚   â”‚   â””â”€â”€ stores/
â”‚   â”‚       â”œâ”€â”€ taskStore.js
â”‚   â”‚       â”œâ”€â”€ wizardStore.js
â”‚   â”‚       â”œâ”€â”€ credentialStore.js
â”‚   â”‚       â””â”€â”€ liveViewStore.js         # ğŸ†• ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼çŠ¶æ…‹ç®¡ç†
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.js
â”‚   â”œâ”€â”€ tailwind.config.js
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ nginx.conf
â”‚
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ README.md
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

### execution_steps ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆğŸ†• ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼ç”¨ï¼‰
```sql
CREATE TABLE execution_steps (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    execution_id INTEGER NOT NULL,
    step_number INTEGER NOT NULL,
    action_type VARCHAR(50) NOT NULL,      -- navigate, click, type, scroll, extract, etc.
    description TEXT,                       -- "ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯"
    status VARCHAR(20) DEFAULT 'pending',   -- pending, running, completed, failed, skipped
    screenshot_path VARCHAR(255),           -- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®ãƒ‘ã‚¹
    element_selector TEXT,                  -- æ“ä½œå¯¾è±¡ã®è¦ç´ ã‚»ãƒ¬ã‚¯ã‚¿
    input_value TEXT,                       -- å…¥åŠ›å€¤ï¼ˆãƒã‚¹ã‚¯æ¸ˆã¿ï¼‰
    result TEXT,                            -- å®Ÿè¡Œçµæœ
    error_message TEXT,                     -- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    started_at DATETIME,
    completed_at DATETIME,
    duration_ms INTEGER,                    -- æ‰€è¦æ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
    FOREIGN KEY (execution_id) REFERENCES executions(id)
);

CREATE INDEX idx_execution_steps_execution_id ON execution_steps(execution_id);
```

### execution_control ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆğŸ†• å®Ÿè¡Œåˆ¶å¾¡ç”¨ï¼‰
```sql
CREATE TABLE execution_control (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    execution_id INTEGER NOT NULL UNIQUE,
    status VARCHAR(20) DEFAULT 'running',   -- running, paused, stopping, stopped
    paused_at DATETIME,
    resumed_at DATETIME,
    stop_requested BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (execution_id) REFERENCES executions(id)
);
```

### executions ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ›´æ–°ï¼‰
```sql
CREATE TABLE executions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    task_id INTEGER NOT NULL,
    status VARCHAR(20) NOT NULL,            -- pending, running, paused, completed, failed, stopped
    started_at DATETIME,
    completed_at DATETIME,
    result TEXT,
    error_message TEXT,
    log_file VARCHAR(255),
    triggered_by VARCHAR(20),               -- manual, schedule, api
    total_steps INTEGER DEFAULT 0,          -- ğŸ†• ç·ã‚¹ãƒ†ãƒƒãƒ—æ•°
    completed_steps INTEGER DEFAULT 0,      -- ğŸ†• å®Œäº†ã‚¹ãƒ†ãƒƒãƒ—æ•°
    current_step_id INTEGER,                -- ğŸ†• ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—ID
    last_screenshot_path VARCHAR(255),      -- ğŸ†• æœ€æ–°ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ
    FOREIGN KEY (task_id) REFERENCES tasks(id),
    FOREIGN KEY (current_step_id) REFERENCES execution_steps(id)
);
```

### credentials ãƒ†ãƒ¼ãƒ–ãƒ«
```sql
CREATE TABLE credentials (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(255) NOT NULL,
    credential_type VARCHAR(50) NOT NULL,
    service_name VARCHAR(100),
    data TEXT NOT NULL,                     -- æš—å·åŒ–ã•ã‚ŒãŸèªè¨¼ãƒ‡ãƒ¼ã‚¿JSON
    description TEXT,
    is_default BOOLEAN DEFAULT FALSE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### tasks ãƒ†ãƒ¼ãƒ–ãƒ«
```sql
CREATE TABLE tasks (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    task_prompt TEXT NOT NULL,
    schedule VARCHAR(100),
    is_active BOOLEAN DEFAULT TRUE,
    notify_on_success BOOLEAN DEFAULT FALSE,
    notify_on_failure BOOLEAN DEFAULT TRUE,
    notification_channel VARCHAR(50),
    notification_target VARCHAR(255),
    llm_credential_id INTEGER,
    site_credential_id INTEGER,
    notification_credential_id INTEGER,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (llm_credential_id) REFERENCES credentials(id),
    FOREIGN KEY (site_credential_id) REFERENCES credentials(id),
    FOREIGN KEY (notification_credential_id) REFERENCES credentials(id)
);
```

---

## API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¨­è¨ˆ

### Live View APIï¼ˆğŸ†•ï¼‰
```
GET    /api/executions/{id}/live           # ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—
GET    /api/executions/{id}/steps          # ã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§å–å¾—
GET    /api/executions/{id}/screenshot     # æœ€æ–°ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆå–å¾—
GET    /api/executions/{id}/screenshots/{step_id}  # ç‰¹å®šã‚¹ãƒ†ãƒƒãƒ—ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ
POST   /api/executions/{id}/pause          # ä¸€æ™‚åœæ­¢
POST   /api/executions/{id}/resume         # å†é–‹
POST   /api/executions/{id}/stop           # åœæ­¢
```

### WebSocketï¼ˆæ›´æ–°ï¼‰
```
WS     /ws/executions/{execution_id}       # å®Ÿè¡Œãƒ­ã‚° + ã‚¹ãƒ†ãƒƒãƒ—æ›´æ–°ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é…ä¿¡
WS     /ws/live/{execution_id}             # ğŸ†• ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼å°‚ç”¨ï¼ˆé«˜é »åº¦æ›´æ–°ï¼‰
WS     /ws/dashboard                       # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°é€šçŸ¥
WS     /ws/wizard/{session_id}             # ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ãƒãƒ£ãƒƒãƒˆ
```

### Tasks API
```
GET    /api/tasks
POST   /api/tasks
GET    /api/tasks/{id}
PUT    /api/tasks/{id}
DELETE /api/tasks/{id}
POST   /api/tasks/{id}/run
POST   /api/tasks/{id}/toggle
```

### Credentials API
```
GET    /api/credentials
POST   /api/credentials
GET    /api/credentials/{id}
PUT    /api/credentials/{id}
DELETE /api/credentials/{id}
POST   /api/credentials/{id}/test
GET    /api/credentials/types
GET    /api/credentials/by-type/{type}
```

### Executions API
```
GET    /api/executions
GET    /api/executions/{id}
GET    /api/executions/{id}/logs
GET    /api/executions/{id}/result/download
DELETE /api/executions/{id}
```

---

## ğŸ†• ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ è©³ç´°ä»•æ§˜

### æ¦‚è¦
Manusã®ã‚ˆã†ã«ã€å®Ÿè¡Œä¸­ã®ã‚¿ã‚¹ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ç¾åœ¨ã®çŠ¶æ…‹ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç¢ºèªã§ãã‚‹æ©Ÿèƒ½ã€‚

### UIæ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â—€ ã‚¿ã‚¹ã‚¯ä¸€è¦§ã«æˆ»ã‚‹     ğŸ”„ å®Ÿè¡Œä¸­: æœã®å£²ä¸Šãƒã‚§ãƒƒã‚¯        â± 00:02:34     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€ ã‚¹ãƒ†ãƒƒãƒ—é€²æ— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  âœ… Step 1: ã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹                              0.8s       â”‚  â”‚
â”‚  â”‚     â””â”€ https://rms.rakuten.co.jp ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ãŸ                  â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  âœ… Step 2: ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã‚’æ¤œå‡º                        1.2s       â”‚  â”‚
â”‚  â”‚     â””â”€ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å…¥åŠ›æ¬„ã‚’ç™ºè¦‹ã—ã¾ã—ãŸ                            â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  ğŸ”„ Step 3: ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’å…¥åŠ›ä¸­...  â† å®Ÿè¡Œä¸­                        â”‚  â”‚
â”‚  â”‚     â””â”€ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã„ã¾ã™                                    â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  â³ Step 4: ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯                                 â”‚  â”‚
â”‚  â”‚  â³ Step 5: å£²ä¸Šç®¡ç†ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ç§»å‹•                                   â”‚  â”‚
â”‚  â”‚  â³ Step 6: ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—                                             â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€ ãƒ–ãƒ©ã‚¦ã‚¶ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€ å®Ÿè¡Œãƒ­ã‚° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                       â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚   ğŸ“· ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ    â”‚  â”‚ 12:03:01 [INFO]           â”‚  â”‚
â”‚  â”‚                                       â”‚  â”‚ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†         â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚   â”‚                             â”‚    â”‚  â”‚ 12:03:02 [INFO]           â”‚  â”‚
â”‚  â”‚   â”‚     (ãƒ©ã‚¤ãƒ–ç”»åƒ)            â”‚    â”‚  â”‚ è¦ç´ ã‚’æ¤œå‡º: #email        â”‚  â”‚
â”‚  â”‚   â”‚                             â”‚    â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚   â”‚     ğŸ”´ ãƒ©ã‚¤ãƒ–               â”‚    â”‚  â”‚ 12:03:03 [INFO]           â”‚  â”‚
â”‚  â”‚   â”‚                             â”‚    â”‚  â”‚ ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›é–‹å§‹          â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚                                       â”‚  â”‚ 12:03:04 [DEBUG]          â”‚  â”‚
â”‚  â”‚   [ğŸ” æ‹¡å¤§] [ğŸ“· ä¿å­˜]                 â”‚  â”‚ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨ˆç”»ä¸­... â”‚  â”‚
â”‚  â”‚                                       â”‚  â”‚                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   [ â¸ ä¸€æ™‚åœæ­¢ ]    [ â¹ åœæ­¢ ]    [ ğŸ“‹ ãƒ­ã‚°ã‚’ã‚³ãƒ”ãƒ¼ ]              â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…

#### services/browser_controller.py
```python
import asyncio
from typing import Optional, Callable
from dataclasses import dataclass, field
from datetime import datetime
import base64

@dataclass
class ExecutionState:
    """å®Ÿè¡ŒçŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹"""
    execution_id: int
    is_paused: bool = False
    is_stopping: bool = False
    is_stopped: bool = False
    current_step: int = 0
    total_steps: int = 0
    pause_event: asyncio.Event = field(default_factory=asyncio.Event)
    
    def __post_init__(self):
        self.pause_event.set()  # åˆæœŸçŠ¶æ…‹ã¯å®Ÿè¡Œå¯èƒ½

class BrowserController:
    """ãƒ–ãƒ©ã‚¦ã‚¶å®Ÿè¡Œã®åˆ¶å¾¡ï¼ˆä¸€æ™‚åœæ­¢ãƒ»åœæ­¢ï¼‰ã‚’ç®¡ç†"""
    
    def __init__(self):
        self._states: dict[int, ExecutionState] = {}
        self._callbacks: dict[int, list[Callable]] = {}
    
    def register_execution(self, execution_id: int) -> ExecutionState:
        """æ–°ã—ã„å®Ÿè¡Œã‚’ç™»éŒ²"""
        state = ExecutionState(execution_id=execution_id)
        self._states[execution_id] = state
        self._callbacks[execution_id] = []
        return state
    
    def get_state(self, execution_id: int) -> Optional[ExecutionState]:
        """å®Ÿè¡ŒçŠ¶æ…‹ã‚’å–å¾—"""
        return self._states.get(execution_id)
    
    def add_callback(self, execution_id: int, callback: Callable):
        """çŠ¶æ…‹å¤‰æ›´æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’è¿½åŠ """
        if execution_id in self._callbacks:
            self._callbacks[execution_id].append(callback)
    
    async def pause(self, execution_id: int) -> bool:
        """å®Ÿè¡Œã‚’ä¸€æ™‚åœæ­¢"""
        state = self._states.get(execution_id)
        if not state or state.is_stopping:
            return False
        
        state.is_paused = True
        state.pause_event.clear()  # å¾…æ©ŸçŠ¶æ…‹ã«
        await self._notify_callbacks(execution_id, "paused")
        return True
    
    async def resume(self, execution_id: int) -> bool:
        """å®Ÿè¡Œã‚’å†é–‹"""
        state = self._states.get(execution_id)
        if not state or not state.is_paused:
            return False
        
        state.is_paused = False
        state.pause_event.set()  # å®Ÿè¡Œå†é–‹
        await self._notify_callbacks(execution_id, "resumed")
        return True
    
    async def stop(self, execution_id: int) -> bool:
        """å®Ÿè¡Œã‚’åœæ­¢"""
        state = self._states.get(execution_id)
        if not state:
            return False
        
        state.is_stopping = True
        state.pause_event.set()  # ä¸€æ™‚åœæ­¢ä¸­ãªã‚‰è§£é™¤
        await self._notify_callbacks(execution_id, "stopping")
        return True
    
    async def wait_if_paused(self, execution_id: int) -> bool:
        """ä¸€æ™‚åœæ­¢ä¸­ãªã‚‰å¾…æ©Ÿã€‚åœæ­¢ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚ã‚Œã°Falseã‚’è¿”ã™"""
        state = self._states.get(execution_id)
        if not state:
            return False
        
        await state.pause_event.wait()
        return not state.is_stopping
    
    def should_continue(self, execution_id: int) -> bool:
        """å®Ÿè¡Œã‚’ç¶šè¡Œã™ã¹ãã‹ç¢ºèª"""
        state = self._states.get(execution_id)
        if not state:
            return False
        return not state.is_stopping
    
    def cleanup(self, execution_id: int):
        """å®Ÿè¡Œçµ‚äº†æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—"""
        self._states.pop(execution_id, None)
        self._callbacks.pop(execution_id, None)
    
    async def _notify_callbacks(self, execution_id: int, event: str):
        """ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å‘¼ã³å‡ºã—"""
        for callback in self._callbacks.get(execution_id, []):
            try:
                if asyncio.iscoroutinefunction(callback):
                    await callback(event)
                else:
                    callback(event)
            except Exception:
                pass

# ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
browser_controller = BrowserController()
```

#### services/live_view_manager.py
```python
import asyncio
import json
import base64
from datetime import datetime
from typing import Optional
from pathlib import Path
from sqlalchemy.orm import Session

from app.models import Execution, ExecutionStep, ExecutionControl
from app.database import get_db

class LiveViewManager:
    """ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã¨WebSocketé…ä¿¡"""
    
    def __init__(self):
        self._connections: dict[int, list] = {}  # execution_id -> WebSocket connections
        self._screenshot_cache: dict[int, str] = {}  # execution_id -> base64 screenshot
    
    def add_connection(self, execution_id: int, websocket):
        """WebSocketæ¥ç¶šã‚’è¿½åŠ """
        if execution_id not in self._connections:
            self._connections[execution_id] = []
        self._connections[execution_id].append(websocket)
    
    def remove_connection(self, execution_id: int, websocket):
        """WebSocketæ¥ç¶šã‚’å‰Šé™¤"""
        if execution_id in self._connections:
            self._connections[execution_id] = [
                ws for ws in self._connections[execution_id] if ws != websocket
            ]
    
    async def broadcast(self, execution_id: int, message: dict):
        """æŒ‡å®šå®Ÿè¡ŒIDã®å…¨æ¥ç¶šã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é…ä¿¡"""
        connections = self._connections.get(execution_id, [])
        dead_connections = []
        
        for ws in connections:
            try:
                await ws.send_json(message)
            except Exception:
                dead_connections.append(ws)
        
        # åˆ‡æ–­ã•ã‚ŒãŸæ¥ç¶šã‚’å‰Šé™¤
        for ws in dead_connections:
            self.remove_connection(execution_id, ws)
    
    async def send_step_update(
        self, 
        execution_id: int, 
        step_number: int,
        action_type: str,
        description: str,
        status: str,
        screenshot_base64: Optional[str] = None,
        duration_ms: Optional[int] = None,
        error_message: Optional[str] = None
    ):
        """ã‚¹ãƒ†ãƒƒãƒ—æ›´æ–°ã‚’é…ä¿¡"""
        message = {
            "type": "step_update",
            "data": {
                "step_number": step_number,
                "action_type": action_type,
                "description": description,
                "status": status,
                "duration_ms": duration_ms,
                "error_message": error_message,
                "timestamp": datetime.now().isoformat()
            }
        }
        
        # ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã¯åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§é€ä¿¡ï¼ˆã‚µã‚¤ã‚ºãŒå¤§ãã„ãŸã‚ï¼‰
        if screenshot_base64:
            self._screenshot_cache[execution_id] = screenshot_base64
            screenshot_message = {
                "type": "screenshot_update",
                "data": {
                    "step_number": step_number,
                    "screenshot": screenshot_base64
                }
            }
            await self.broadcast(execution_id, screenshot_message)
        
        await self.broadcast(execution_id, message)
    
    async def send_log(self, execution_id: int, level: str, message: str):
        """ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é…ä¿¡"""
        log_message = {
            "type": "log",
            "data": {
                "level": level,
                "message": message,
                "timestamp": datetime.now().isoformat()
            }
        }
        await self.broadcast(execution_id, log_message)
    
    async def send_control_update(self, execution_id: int, status: str):
        """åˆ¶å¾¡çŠ¶æ…‹ã®æ›´æ–°ã‚’é…ä¿¡"""
        message = {
            "type": "control_update",
            "data": {
                "status": status,
                "timestamp": datetime.now().isoformat()
            }
        }
        await self.broadcast(execution_id, message)
    
    async def send_progress_update(
        self, 
        execution_id: int, 
        current_step: int, 
        total_steps: int
    ):
        """é€²æ—æ›´æ–°ã‚’é…ä¿¡"""
        message = {
            "type": "progress_update",
            "data": {
                "current_step": current_step,
                "total_steps": total_steps,
                "percentage": round(current_step / total_steps * 100) if total_steps > 0 else 0
            }
        }
        await self.broadcast(execution_id, message)
    
    def get_cached_screenshot(self, execution_id: int) -> Optional[str]:
        """ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’å–å¾—"""
        return self._screenshot_cache.get(execution_id)
    
    def cleanup(self, execution_id: int):
        """å®Ÿè¡Œçµ‚äº†æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—"""
        self._connections.pop(execution_id, None)
        self._screenshot_cache.pop(execution_id, None)

# ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
live_view_manager = LiveViewManager()
```

#### services/agent.pyï¼ˆæ›´æ–°ç‰ˆ - ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼å¯¾å¿œï¼‰
```python
import asyncio
import base64
import os
from datetime import datetime
from pathlib import Path
from typing import Optional

from browser_use import Agent, Controller, Browser, BrowserConfig
from browser_use.browser.context import BrowserContext
from langchain_anthropic import ChatAnthropic
from sqlalchemy.orm import Session

from app.models import Task, Execution, ExecutionStep, ExecutionControl
from app.database import SessionLocal
from app.services.browser_controller import browser_controller, ExecutionState
from app.services.live_view_manager import live_view_manager
from app.services.credential_manager import CredentialManager

SCREENSHOT_DIR = Path("screenshots")
SCREENSHOT_DIR.mkdir(exist_ok=True)

class LiveViewAgent:
    """ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼å¯¾å¿œã®Browser Useã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ"""
    
    def __init__(
        self,
        task: Task,
        execution: Execution,
        db: Session,
        credential_manager: CredentialManager
    ):
        self.task = task
        self.execution = execution
        self.db = db
        self.credential_manager = credential_manager
        self.step_count = 0
        self.browser: Optional[Browser] = None
        self.context: Optional[BrowserContext] = None
        self.state: Optional[ExecutionState] = None
    
    async def run(self) -> dict:
        """ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œ"""
        try:
            # å®Ÿè¡ŒçŠ¶æ…‹ã‚’ç™»éŒ²
            self.state = browser_controller.register_execution(self.execution.id)
            
            # åˆ¶å¾¡çŠ¶æ…‹ã®å¤‰æ›´æ™‚ã«WebSocketé…ä¿¡
            browser_controller.add_callback(
                self.execution.id,
                lambda event: asyncio.create_task(
                    live_view_manager.send_control_update(self.execution.id, event)
                )
            )
            
            # LLM APIã‚­ãƒ¼ã‚’å–å¾—
            llm_credential = self.credential_manager.get_default(self.db, "api_key")
            if not llm_credential:
                raise ValueError("LLM APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“")
            
            api_key = llm_credential["data"]["api_key"]
            
            # ãƒ–ãƒ©ã‚¦ã‚¶ã‚’èµ·å‹•
            self.browser = Browser(
                config=BrowserConfig(
                    headless=True,
                    disable_security=True,
                    extra_chromium_args=[
                        "--no-sandbox",
                        "--disable-setuid-sandbox",
                        "--disable-dev-shm-usage",
                        "--disable-gpu"
                    ]
                )
            )
            
            # LLMã‚’åˆæœŸåŒ–
            llm = ChatAnthropic(
                model="claude-sonnet-4-20250514",
                api_key=api_key
            )
            
            # ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä½œæˆ
            controller = Controller()
            
            # å„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å‰å¾Œã«ãƒ•ãƒƒã‚¯ã‚’è¿½åŠ 
            original_act = controller.act
            
            async def wrapped_act(action, *args, **kwargs):
                # ä¸€æ™‚åœæ­¢ãƒã‚§ãƒƒã‚¯
                should_continue = await browser_controller.wait_if_paused(self.execution.id)
                if not should_continue:
                    raise InterruptedError("å®Ÿè¡ŒãŒåœæ­¢ã•ã‚Œã¾ã—ãŸ")
                
                # ã‚¹ãƒ†ãƒƒãƒ—é–‹å§‹ã‚’è¨˜éŒ²
                self.step_count += 1
                step = await self._create_step(
                    step_number=self.step_count,
                    action_type=action.__class__.__name__,
                    description=str(action),
                    status="running"
                )
                
                # ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼ã«é€šçŸ¥
                await live_view_manager.send_step_update(
                    execution_id=self.execution.id,
                    step_number=self.step_count,
                    action_type=action.__class__.__name__,
                    description=str(action),
                    status="running"
                )
                
                start_time = datetime.now()
                
                try:
                    # ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
                    result = await original_act(action, *args, **kwargs)
                    
                    # ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’å–å¾—
                    screenshot_base64 = await self._take_screenshot(self.step_count)
                    
                    # ã‚¹ãƒ†ãƒƒãƒ—ã‚’å®Œäº†ã«æ›´æ–°
                    duration_ms = int((datetime.now() - start_time).total_seconds() * 1000)
                    await self._update_step(
                        step,
                        status="completed",
                        screenshot_path=f"screenshots/{self.execution.id}/{self.step_count}.png",
                        duration_ms=duration_ms
                    )
                    
                    # ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼ã«é€šçŸ¥
                    await live_view_manager.send_step_update(
                        execution_id=self.execution.id,
                        step_number=self.step_count,
                        action_type=action.__class__.__name__,
                        description=str(action),
                        status="completed",
                        screenshot_base64=screenshot_base64,
                        duration_ms=duration_ms
                    )
                    
                    # ãƒ­ã‚°ã‚’é€ä¿¡
                    await live_view_manager.send_log(
                        self.execution.id,
                        "INFO",
                        f"Step {self.step_count}: {action.__class__.__name__} å®Œäº†"
                    )
                    
                    return result
                    
                except Exception as e:
                    # ã‚¨ãƒ©ãƒ¼ã‚’è¨˜éŒ²
                    duration_ms = int((datetime.now() - start_time).total_seconds() * 1000)
                    await self._update_step(
                        step,
                        status="failed",
                        error_message=str(e),
                        duration_ms=duration_ms
                    )
                    
                    # ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼ã«é€šçŸ¥
                    await live_view_manager.send_step_update(
                        execution_id=self.execution.id,
                        step_number=self.step_count,
                        action_type=action.__class__.__name__,
                        description=str(action),
                        status="failed",
                        error_message=str(e),
                        duration_ms=duration_ms
                    )
                    
                    raise
            
            controller.act = wrapped_act
            
            # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½œæˆãƒ»å®Ÿè¡Œ
            agent = Agent(
                task=self.task.task_prompt,
                llm=llm,
                controller=controller,
                browser=self.browser
            )
            
            # å®Ÿè¡Œé–‹å§‹ã‚’é€šçŸ¥
            await live_view_manager.send_log(
                self.execution.id,
                "INFO",
                f"ã‚¿ã‚¹ã‚¯é–‹å§‹: {self.task.name}"
            )
            
            result = await agent.run()
            
            # å®Ÿè¡Œå®Œäº†ã‚’é€šçŸ¥
            await live_view_manager.send_log(
                self.execution.id,
                "INFO",
                "ã‚¿ã‚¹ã‚¯å®Œäº†"
            )
            
            return {
                "success": True,
                "result": result,
                "total_steps": self.step_count
            }
            
        except InterruptedError as e:
            return {
                "success": False,
                "error": str(e),
                "stopped": True,
                "total_steps": self.step_count
            }
        except Exception as e:
            await live_view_manager.send_log(
                self.execution.id,
                "ERROR",
                f"ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: {str(e)}"
            )
            return {
                "success": False,
                "error": str(e),
                "total_steps": self.step_count
            }
        finally:
            # ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
            if self.browser:
                await self.browser.close()
            browser_controller.cleanup(self.execution.id)
            live_view_manager.cleanup(self.execution.id)
    
    async def _create_step(
        self,
        step_number: int,
        action_type: str,
        description: str,
        status: str
    ) -> ExecutionStep:
        """ã‚¹ãƒ†ãƒƒãƒ—ã‚’DBã«ä½œæˆ"""
        step = ExecutionStep(
            execution_id=self.execution.id,
            step_number=step_number,
            action_type=action_type,
            description=description,
            status=status,
            started_at=datetime.now()
        )
        self.db.add(step)
        self.db.commit()
        self.db.refresh(step)
        
        # å®Ÿè¡Œã®ç¾åœ¨ã‚¹ãƒ†ãƒƒãƒ—ã‚’æ›´æ–°
        self.execution.current_step_id = step.id
        self.execution.total_steps = step_number
        self.db.commit()
        
        return step
    
    async def _update_step(
        self,
        step: ExecutionStep,
        status: str,
        screenshot_path: Optional[str] = None,
        duration_ms: Optional[int] = None,
        error_message: Optional[str] = None
    ):
        """ã‚¹ãƒ†ãƒƒãƒ—ã‚’æ›´æ–°"""
        step.status = status
        step.completed_at = datetime.now()
        if screenshot_path:
            step.screenshot_path = screenshot_path
        if duration_ms:
            step.duration_ms = duration_ms
        if error_message:
            step.error_message = error_message
        
        self.db.commit()
        
        # å®Œäº†ã‚¹ãƒ†ãƒƒãƒ—æ•°ã‚’æ›´æ–°
        if status == "completed":
            self.execution.completed_steps = (self.execution.completed_steps or 0) + 1
            self.db.commit()
    
    async def _take_screenshot(self, step_number: int) -> Optional[str]:
        """ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’å–å¾—ã—ã¦Base64ã§è¿”ã™"""
        try:
            if not self.browser:
                return None
            
            # ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’å–å¾—
            page = await self.browser.get_current_page()
            if not page:
                return None
            
            screenshot_bytes = await page.screenshot(type="png")
            
            # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
            screenshot_dir = SCREENSHOT_DIR / str(self.execution.id)
            screenshot_dir.mkdir(parents=True, exist_ok=True)
            screenshot_path = screenshot_dir / f"{step_number}.png"
            
            with open(screenshot_path, "wb") as f:
                f.write(screenshot_bytes)
            
            # å®Ÿè¡Œã®æœ€æ–°ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãƒ‘ã‚¹ã‚’æ›´æ–°
            self.execution.last_screenshot_path = str(screenshot_path)
            self.db.commit()
            
            # Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
            return base64.b64encode(screenshot_bytes).decode("utf-8")
            
        except Exception as e:
            await live_view_manager.send_log(
                self.execution.id,
                "WARNING",
                f"ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆå–å¾—å¤±æ•—: {str(e)}"
            )
            return None


async def run_task_with_live_view(task_id: int, execution_id: int):
    """ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼å¯¾å¿œã§ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ç”¨ï¼‰"""
    db = SessionLocal()
    try:
        task = db.query(Task).filter(Task.id == task_id).first()
        execution = db.query(Execution).filter(Execution.id == execution_id).first()
        
        if not task or not execution:
            return
        
        # å®Ÿè¡ŒçŠ¶æ…‹ã‚’æ›´æ–°
        execution.status = "running"
        execution.started_at = datetime.now()
        db.commit()
        
        # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œ
        credential_manager = CredentialManager()
        agent = LiveViewAgent(
            task=task,
            execution=execution,
            db=db,
            credential_manager=credential_manager
        )
        
        result = await agent.run()
        
        # çµæœã‚’ä¿å­˜
        if result.get("stopped"):
            execution.status = "stopped"
        elif result.get("success"):
            execution.status = "completed"
            execution.result = str(result.get("result"))
        else:
            execution.status = "failed"
            execution.error_message = result.get("error")
        
        execution.completed_at = datetime.now()
        db.commit()
        
    except Exception as e:
        if execution:
            execution.status = "failed"
            execution.error_message = str(e)
            execution.completed_at = datetime.now()
            db.commit()
    finally:
        db.close()
```

#### routers/live_view.py
```python
from fastapi import APIRouter, HTTPException, Depends, WebSocket, WebSocketDisconnect
from sqlalchemy.orm import Session
import json

from app.database import get_db
from app.models import Execution, ExecutionStep
from app.services.browser_controller import browser_controller
from app.services.live_view_manager import live_view_manager

router = APIRouter()

@router.get("/executions/{execution_id}/live")
async def get_live_view_data(execution_id: int, db: Session = Depends(get_db)):
    """ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼ã®ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—"""
    execution = db.query(Execution).filter(Execution.id == execution_id).first()
    if not execution:
        raise HTTPException(status_code=404, detail="å®Ÿè¡ŒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
    
    # ã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§ã‚’å–å¾—
    steps = db.query(ExecutionStep).filter(
        ExecutionStep.execution_id == execution_id
    ).order_by(ExecutionStep.step_number).all()
    
    # åˆ¶å¾¡çŠ¶æ…‹ã‚’å–å¾—
    state = browser_controller.get_state(execution_id)
    
    return {
        "execution": {
            "id": execution.id,
            "status": execution.status,
            "started_at": execution.started_at.isoformat() if execution.started_at else None,
            "total_steps": execution.total_steps,
            "completed_steps": execution.completed_steps
        },
        "steps": [
            {
                "step_number": s.step_number,
                "action_type": s.action_type,
                "description": s.description,
                "status": s.status,
                "duration_ms": s.duration_ms,
                "error_message": s.error_message,
                "started_at": s.started_at.isoformat() if s.started_at else None,
                "completed_at": s.completed_at.isoformat() if s.completed_at else None
            }
            for s in steps
        ],
        "control": {
            "is_paused": state.is_paused if state else False,
            "is_stopping": state.is_stopping if state else False
        },
        "screenshot": live_view_manager.get_cached_screenshot(execution_id)
    }

@router.get("/executions/{execution_id}/steps")
async def get_execution_steps(execution_id: int, db: Session = Depends(get_db)):
    """å®Ÿè¡Œã®ã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§ã‚’å–å¾—"""
    steps = db.query(ExecutionStep).filter(
        ExecutionStep.execution_id == execution_id
    ).order_by(ExecutionStep.step_number).all()
    
    return [
        {
            "id": s.id,
            "step_number": s.step_number,
            "action_type": s.action_type,
            "description": s.description,
            "status": s.status,
            "screenshot_path": s.screenshot_path,
            "duration_ms": s.duration_ms,
            "error_message": s.error_message,
            "started_at": s.started_at.isoformat() if s.started_at else None,
            "completed_at": s.completed_at.isoformat() if s.completed_at else None
        }
        for s in steps
    ]

@router.get("/executions/{execution_id}/screenshot")
async def get_latest_screenshot(execution_id: int):
    """æœ€æ–°ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’å–å¾—"""
    screenshot = live_view_manager.get_cached_screenshot(execution_id)
    if not screenshot:
        raise HTTPException(status_code=404, detail="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãŒã‚ã‚Šã¾ã›ã‚“")
    
    return {"screenshot": screenshot}

@router.post("/executions/{execution_id}/pause")
async def pause_execution(execution_id: int, db: Session = Depends(get_db)):
    """å®Ÿè¡Œã‚’ä¸€æ™‚åœæ­¢"""
    execution = db.query(Execution).filter(Execution.id == execution_id).first()
    if not execution:
        raise HTTPException(status_code=404, detail="å®Ÿè¡ŒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
    
    if execution.status != "running":
        raise HTTPException(status_code=400, detail="å®Ÿè¡Œä¸­ã®ã‚¿ã‚¹ã‚¯ã®ã¿ä¸€æ™‚åœæ­¢ã§ãã¾ã™")
    
    success = await browser_controller.pause(execution_id)
    if not success:
        raise HTTPException(status_code=400, detail="ä¸€æ™‚åœæ­¢ã«å¤±æ•—ã—ã¾ã—ãŸ")
    
    execution.status = "paused"
    db.commit()
    
    return {"message": "ä¸€æ™‚åœæ­¢ã—ã¾ã—ãŸ", "status": "paused"}

@router.post("/executions/{execution_id}/resume")
async def resume_execution(execution_id: int, db: Session = Depends(get_db)):
    """å®Ÿè¡Œã‚’å†é–‹"""
    execution = db.query(Execution).filter(Execution.id == execution_id).first()
    if not execution:
        raise HTTPException(status_code=404, detail="å®Ÿè¡ŒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
    
    if execution.status != "paused":
        raise HTTPException(status_code=400, detail="ä¸€æ™‚åœæ­¢ä¸­ã®ã‚¿ã‚¹ã‚¯ã®ã¿å†é–‹ã§ãã¾ã™")
    
    success = await browser_controller.resume(execution_id)
    if not success:
        raise HTTPException(status_code=400, detail="å†é–‹ã«å¤±æ•—ã—ã¾ã—ãŸ")
    
    execution.status = "running"
    db.commit()
    
    return {"message": "å†é–‹ã—ã¾ã—ãŸ", "status": "running"}

@router.post("/executions/{execution_id}/stop")
async def stop_execution(execution_id: int, db: Session = Depends(get_db)):
    """å®Ÿè¡Œã‚’åœæ­¢"""
    execution = db.query(Execution).filter(Execution.id == execution_id).first()
    if not execution:
        raise HTTPException(status_code=404, detail="å®Ÿè¡ŒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
    
    if execution.status not in ["running", "paused"]:
        raise HTTPException(status_code=400, detail="å®Ÿè¡Œä¸­ã¾ãŸã¯ä¸€æ™‚åœæ­¢ä¸­ã®ã‚¿ã‚¹ã‚¯ã®ã¿åœæ­¢ã§ãã¾ã™")
    
    success = await browser_controller.stop(execution_id)
    if not success:
        raise HTTPException(status_code=400, detail="åœæ­¢ã«å¤±æ•—ã—ã¾ã—ãŸ")
    
    return {"message": "åœæ­¢ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¾ã—ãŸ", "status": "stopping"}


@router.websocket("/ws/live/{execution_id}")
async def live_view_websocket(websocket: WebSocket, execution_id: int):
    """ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼ç”¨WebSocket"""
    await websocket.accept()
    live_view_manager.add_connection(execution_id, websocket)
    
    try:
        # åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡
        screenshot = live_view_manager.get_cached_screenshot(execution_id)
        if screenshot:
            await websocket.send_json({
                "type": "screenshot_update",
                "data": {"screenshot": screenshot}
            })
        
        # æ¥ç¶šã‚’ç¶­æŒ
        while True:
            try:
                # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¾…ã¤ï¼ˆping/pongç”¨ï¼‰
                data = await websocket.receive_text()
                if data == "ping":
                    await websocket.send_text("pong")
            except WebSocketDisconnect:
                break
    finally:
        live_view_manager.remove_connection(execution_id, websocket)
```

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

#### stores/liveViewStore.js
```javascript
import { create } from 'zustand';

const useLiveViewStore = create((set, get) => ({
  // çŠ¶æ…‹
  executionId: null,
  status: 'idle', // idle, connecting, connected, disconnected
  controlStatus: 'running', // running, paused, stopping, stopped
  steps: [],
  currentStep: 0,
  totalSteps: 0,
  logs: [],
  screenshot: null,
  elapsedTime: 0,
  error: null,
  
  // WebSocketæ¥ç¶š
  ws: null,
  
  // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  connect: (executionId) => {
    const ws = new WebSocket(`ws://${window.location.host}/ws/live/${executionId}`);
    
    ws.onopen = () => {
      set({ status: 'connected', executionId, error: null });
    };
    
    ws.onmessage = (event) => {
      const message = JSON.parse(event.data);
      const { type, data } = message;
      
      switch (type) {
        case 'step_update':
          set((state) => {
            const steps = [...state.steps];
            const existingIndex = steps.findIndex(s => s.step_number === data.step_number);
            
            if (existingIndex >= 0) {
              steps[existingIndex] = { ...steps[existingIndex], ...data };
            } else {
              steps.push(data);
            }
            
            return {
              steps: steps.sort((a, b) => a.step_number - b.step_number),
              currentStep: data.status === 'running' ? data.step_number : state.currentStep
            };
          });
          break;
          
        case 'screenshot_update':
          set({ screenshot: data.screenshot });
          break;
          
        case 'log':
          set((state) => ({
            logs: [...state.logs, data].slice(-100) // æœ€æ–°100ä»¶ã‚’ä¿æŒ
          }));
          break;
          
        case 'control_update':
          set({ controlStatus: data.status });
          break;
          
        case 'progress_update':
          set({
            currentStep: data.current_step,
            totalSteps: data.total_steps
          });
          break;
      }
    };
    
    ws.onclose = () => {
      set({ status: 'disconnected' });
    };
    
    ws.onerror = (error) => {
      set({ error: 'WebSocketæ¥ç¶šã‚¨ãƒ©ãƒ¼', status: 'disconnected' });
    };
    
    set({ ws, status: 'connecting' });
    
    // Ping/Pongã§æ¥ç¶šç¶­æŒ
    const pingInterval = setInterval(() => {
      if (ws.readyState === WebSocket.OPEN) {
        ws.send('ping');
      }
    }, 30000);
    
    return () => {
      clearInterval(pingInterval);
      ws.close();
    };
  },
  
  disconnect: () => {
    const { ws } = get();
    if (ws) {
      ws.close();
    }
    set({
      ws: null,
      executionId: null,
      status: 'idle',
      steps: [],
      logs: [],
      screenshot: null
    });
  },
  
  setInitialData: (data) => {
    set({
      steps: data.steps || [],
      controlStatus: data.control?.is_paused ? 'paused' : 'running',
      screenshot: data.screenshot,
      totalSteps: data.execution?.total_steps || 0,
      currentStep: data.execution?.completed_steps || 0
    });
  },
  
  clearLogs: () => set({ logs: [] }),
  
  updateElapsedTime: (time) => set({ elapsedTime: time })
}));

export default useLiveViewStore;
```

#### components/LiveView/index.jsx
```jsx
import { useEffect, useState, useRef } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import useLiveViewStore from '../../stores/liveViewStore';
import api from '../../services/api';
import StepProgress from './StepProgress';
import ScreenshotViewer from './ScreenshotViewer';
import ControlPanel from './ControlPanel';
import LogStream from './LogStream';

export default function LiveView() {
  const { executionId } = useParams();
  const navigate = useNavigate();
  const [task, setTask] = useState(null);
  const [isLoading, setIsLoading] = useState(true);
  const timerRef = useRef(null);
  
  const {
    status,
    controlStatus,
    steps,
    currentStep,
    totalSteps,
    logs,
    screenshot,
    elapsedTime,
    connect,
    disconnect,
    setInitialData,
    updateElapsedTime
  } = useLiveViewStore();
  
  // åˆæœŸãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã¨WebSocketæ¥ç¶š
  useEffect(() => {
    const init = async () => {
      try {
        // ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        const liveResponse = await api.get(`/executions/${executionId}/live`);
        setInitialData(liveResponse.data);
        
        // ã‚¿ã‚¹ã‚¯æƒ…å ±ã‚’å–å¾—
        const execResponse = await api.get(`/executions/${executionId}`);
        setTask(execResponse.data.task);
        
        // WebSocketæ¥ç¶š
        connect(executionId);
        
        setIsLoading(false);
      } catch (error) {
        console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
        setIsLoading(false);
      }
    };
    
    init();
    
    return () => {
      disconnect();
      if (timerRef.current) {
        clearInterval(timerRef.current);
      }
    };
  }, [executionId]);
  
  // çµŒéæ™‚é–“ã‚¿ã‚¤ãƒãƒ¼
  useEffect(() => {
    if (controlStatus === 'running') {
      timerRef.current = setInterval(() => {
        updateElapsedTime(elapsedTime + 1);
      }, 1000);
    } else {
      if (timerRef.current) {
        clearInterval(timerRef.current);
      }
    }
    
    return () => {
      if (timerRef.current) {
        clearInterval(timerRef.current);
      }
    };
  }, [controlStatus, elapsedTime]);
  
  // çµŒéæ™‚é–“ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
  const formatTime = (seconds) => {
    const h = Math.floor(seconds / 3600);
    const m = Math.floor((seconds % 3600) / 60);
    const s = seconds % 60;
    return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
  };
  
  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸
  const getStatusBadge = () => {
    const statusMap = {
      running: { text: 'å®Ÿè¡Œä¸­', color: 'bg-blue-500', icon: 'ğŸ”„' },
      paused: { text: 'ä¸€æ™‚åœæ­¢', color: 'bg-yellow-500', icon: 'â¸' },
      stopping: { text: 'åœæ­¢ä¸­...', color: 'bg-orange-500', icon: 'â³' },
      stopped: { text: 'åœæ­¢', color: 'bg-gray-500', icon: 'â¹' },
      completed: { text: 'å®Œäº†', color: 'bg-green-500', icon: 'âœ…' },
      failed: { text: 'å¤±æ•—', color: 'bg-red-500', icon: 'âŒ' }
    };
    const s = statusMap[controlStatus] || statusMap.running;
    return (
      <span className={`px-3 py-1 rounded-full text-white text-sm ${s.color}`}>
        {s.icon} {s.text}
      </span>
    );
  };
  
  if (isLoading) {
    return (
      <div className="flex items-center justify-center h-screen">
        <div className="text-lg">èª­ã¿è¾¼ã¿ä¸­...</div>
      </div>
    );
  }
  
  return (
    <div className="min-h-screen bg-gray-50">
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <div className="bg-white border-b px-6 py-4">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-4">
            <button
              onClick={() => navigate('/tasks')}
              className="text-gray-500 hover:text-gray-700"
            >
              â—€ ã‚¿ã‚¹ã‚¯ä¸€è¦§ã«æˆ»ã‚‹
            </button>
            <h1 className="text-xl font-bold">{task?.name || 'ã‚¿ã‚¹ã‚¯å®Ÿè¡Œ'}</h1>
            {getStatusBadge()}
          </div>
          <div className="flex items-center gap-4">
            <span className="text-gray-500">â± {formatTime(elapsedTime)}</span>
            <span className="text-sm text-gray-400">
              æ¥ç¶š: {status === 'connected' ? 'ğŸŸ¢' : 'ğŸ”´'}
            </span>
          </div>
        </div>
      </div>
      
      {/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
      <div className="p-6">
        {/* ã‚¹ãƒ†ãƒƒãƒ—é€²æ— */}
        <div className="bg-white rounded-lg shadow mb-6">
          <div className="px-4 py-3 border-b">
            <h2 className="font-semibold">ã‚¹ãƒ†ãƒƒãƒ—é€²æ—</h2>
          </div>
          <div className="p-4 max-h-80 overflow-y-auto">
            <StepProgress
              steps={steps}
              currentStep={currentStep}
              totalSteps={totalSteps}
            />
          </div>
        </div>
        
        {/* ãƒ–ãƒ©ã‚¦ã‚¶ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ & ãƒ­ã‚° */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          {/* ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ */}
          <div className="bg-white rounded-lg shadow">
            <div className="px-4 py-3 border-b flex items-center justify-between">
              <h2 className="font-semibold">ãƒ–ãƒ©ã‚¦ã‚¶ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
              {controlStatus === 'running' && (
                <span className="text-xs text-red-500 animate-pulse">ğŸ”´ LIVE</span>
              )}
            </div>
            <div className="p-4">
              <ScreenshotViewer
                screenshot={screenshot}
                executionId={executionId}
              />
            </div>
          </div>
          
          {/* ãƒ­ã‚°ã‚¹ãƒˆãƒªãƒ¼ãƒ  */}
          <div className="bg-white rounded-lg shadow">
            <div className="px-4 py-3 border-b">
              <h2 className="font-semibold">å®Ÿè¡Œãƒ­ã‚°</h2>
            </div>
            <div className="p-4">
              <LogStream logs={logs} />
            </div>
          </div>
        </div>
        
        {/* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */}
        <ControlPanel
          executionId={executionId}
          status={controlStatus}
          logs={logs}
        />
      </div>
    </div>
  );
}
```

#### components/LiveView/StepProgress.jsx
```jsx
export default function StepProgress({ steps, currentStep, totalSteps }) {
  const getStepIcon = (status) => {
    switch (status) {
      case 'completed':
        return 'âœ…';
      case 'running':
        return 'ğŸ”„';
      case 'failed':
        return 'âŒ';
      case 'skipped':
        return 'â­';
      default:
        return 'â³';
    }
  };
  
  const getStepColor = (status) => {
    switch (status) {
      case 'completed':
        return 'border-green-500 bg-green-50';
      case 'running':
        return 'border-blue-500 bg-blue-50 animate-pulse';
      case 'failed':
        return 'border-red-500 bg-red-50';
      case 'skipped':
        return 'border-gray-400 bg-gray-50';
      default:
        return 'border-gray-200 bg-white';
    }
  };
  
  const formatDuration = (ms) => {
    if (!ms) return '';
    if (ms < 1000) return `${ms}ms`;
    return `${(ms / 1000).toFixed(1)}s`;
  };
  
  // æœªå®Ÿè¡Œã‚¹ãƒ†ãƒƒãƒ—ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼
  const placeholderSteps = [];
  if (totalSteps > steps.length) {
    for (let i = steps.length + 1; i <= totalSteps; i++) {
      placeholderSteps.push({
        step_number: i,
        status: 'pending',
        description: 'å®Ÿè¡Œå¾…ã¡...'
      });
    }
  }
  
  const allSteps = [...steps, ...placeholderSteps];
  
  if (allSteps.length === 0) {
    return (
      <div className="text-center py-8 text-gray-400">
        ã‚¹ãƒ†ãƒƒãƒ—ã‚’å¾…æ©Ÿä¸­...
      </div>
    );
  }
  
  return (
    <div className="space-y-3">
      {allSteps.map((step) => (
        <div
          key={step.step_number}
          className={`border-l-4 pl-4 py-2 rounded-r ${getStepColor(step.status)}`}
        >
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-2">
              <span className="text-lg">{getStepIcon(step.status)}</span>
              <span className="font-medium">
                Step {step.step_number}: {step.action_type || 'å‡¦ç†ä¸­'}
              </span>
              {step.status === 'running' && (
                <span className="text-xs text-blue-600">â† å®Ÿè¡Œä¸­</span>
              )}
            </div>
            {step.duration_ms && (
              <span className="text-sm text-gray-500">
                {formatDuration(step.duration_ms)}
              </span>
            )}
          </div>
          
          {step.description && (
            <p className="text-sm text-gray-600 mt-1 ml-7">
              â””â”€ {step.description}
            </p>
          )}
          
          {step.error_message && (
            <p className="text-sm text-red-600 mt-1 ml-7">
              â””â”€ ã‚¨ãƒ©ãƒ¼: {step.error_message}
            </p>
          )}
        </div>
      ))}
    </div>
  );
}
```

#### components/LiveView/ScreenshotViewer.jsx
```jsx
import { useState } from 'react';

export default function ScreenshotViewer({ screenshot, executionId }) {
  const [isExpanded, setIsExpanded] = useState(false);
  
  if (!screenshot) {
    return (
      <div className="aspect-video bg-gray-100 rounded-lg flex items-center justify-center">
        <div className="text-center text-gray-400">
          <div className="text-4xl mb-2">ğŸ“·</div>
          <p>ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’å¾…æ©Ÿä¸­...</p>
        </div>
      </div>
    );
  }
  
  const handleSave = () => {
    const link = document.createElement('a');
    link.href = `data:image/png;base64,${screenshot}`;
    link.download = `screenshot-${executionId}-${Date.now()}.png`;
    link.click();
  };
  
  return (
    <div>
      <div 
        className="relative cursor-pointer group"
        onClick={() => setIsExpanded(true)}
      >
        <img
          src={`data:image/png;base64,${screenshot}`}
          alt="ãƒ–ãƒ©ã‚¦ã‚¶ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ"
          className="w-full rounded-lg border"
        />
        <div className="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all flex items-center justify-center">
          <span className="opacity-0 group-hover:opacity-100 text-white text-lg">
            ğŸ” ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ‹¡å¤§
          </span>
        </div>
      </div>
      
      <div className="flex gap-2 mt-3">
        <button
          onClick={() => setIsExpanded(true)}
          className="flex-1 py-2 border rounded hover:bg-gray-50 text-sm"
        >
          ğŸ” æ‹¡å¤§
        </button>
        <button
          onClick={handleSave}
          className="flex-1 py-2 border rounded hover:bg-gray-50 text-sm"
        >
          ğŸ“· ä¿å­˜
        </button>
      </div>
      
      {/* æ‹¡å¤§ãƒ¢ãƒ¼ãƒ€ãƒ« */}
      {isExpanded && (
        <div 
          className="fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4"
          onClick={() => setIsExpanded(false)}
        >
          <div className="max-w-full max-h-full overflow-auto">
            <img
              src={`data:image/png;base64,${screenshot}`}
              alt="ãƒ–ãƒ©ã‚¦ã‚¶ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ"
              className="max-w-none"
            />
          </div>
          <button
            onClick={() => setIsExpanded(false)}
            className="absolute top-4 right-4 text-white text-2xl hover:text-gray-300"
          >
            âœ•
          </button>
        </div>
      )}
    </div>
  );
}
```

#### components/LiveView/ControlPanel.jsx
```jsx
import { useState } from 'react';
import api from '../../services/api';

export default function ControlPanel({ executionId, status, logs }) {
  const [isLoading, setIsLoading] = useState(false);
  
  const handlePause = async () => {
    setIsLoading(true);
    try {
      await api.post(`/executions/${executionId}/pause`);
    } catch (error) {
      alert('ä¸€æ™‚åœæ­¢ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
    }
    setIsLoading(false);
  };
  
  const handleResume = async () => {
    setIsLoading(true);
    try {
      await api.post(`/executions/${executionId}/resume`);
    } catch (error) {
      alert('å†é–‹ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
    }
    setIsLoading(false);
  };
  
  const handleStop = async () => {
    if (!confirm('æœ¬å½“ã«å®Ÿè¡Œã‚’åœæ­¢ã—ã¾ã™ã‹ï¼Ÿ')) return;
    
    setIsLoading(true);
    try {
      await api.post(`/executions/${executionId}/stop`);
    } catch (error) {
      alert('åœæ­¢ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
    }
    setIsLoading(false);
  };
  
  const handleCopyLogs = () => {
    const logText = logs.map(l => 
      `[${l.timestamp}] [${l.level}] ${l.message}`
    ).join('\n');
    
    navigator.clipboard.writeText(logText);
    alert('ãƒ­ã‚°ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
  };
  
  const isRunning = status === 'running';
  const isPaused = status === 'paused';
  const canControl = isRunning || isPaused;
  
  return (
    <div className="bg-white rounded-lg shadow p-4">
      <div className="flex items-center justify-between">
        <h2 className="font-semibold">ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h2>
        
        <div className="flex gap-3">
          {isRunning && (
            <button
              onClick={handlePause}
              disabled={isLoading}
              className="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 disabled:opacity-50"
            >
              â¸ ä¸€æ™‚åœæ­¢
            </button>
          )}
          
          {isPaused && (
            <button
              onClick={handleResume}
              disabled={isLoading}
              className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50"
            >
              â–¶ å†é–‹
            </button>
          )}
          
          {canControl && (
            <button
              onClick={handleStop}
              disabled={isLoading}
              className="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 disabled:opacity-50"
            >
              â¹ åœæ­¢
            </button>
          )}
          
          <button
            onClick={handleCopyLogs}
            className="px-4 py-2 border rounded-lg hover:bg-gray-50"
          >
            ğŸ“‹ ãƒ­ã‚°ã‚’ã‚³ãƒ”ãƒ¼
          </button>
        </div>
      </div>
    </div>
  );
}
```

#### components/LiveView/LogStream.jsx
```jsx
import { useEffect, useRef } from 'react';

export default function LogStream({ logs }) {
  const containerRef = useRef(null);
  
  // è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
  useEffect(() => {
    if (containerRef.current) {
      containerRef.current.scrollTop = containerRef.current.scrollHeight;
    }
  }, [logs]);
  
  const getLevelColor = (level) => {
    switch (level?.toUpperCase()) {
      case 'ERROR':
        return 'text-red-600';
      case 'WARNING':
        return 'text-yellow-600';
      case 'DEBUG':
        return 'text-gray-400';
      default:
        return 'text-gray-700';
    }
  };
  
  const formatTime = (timestamp) => {
    if (!timestamp) return '';
    const date = new Date(timestamp);
    return date.toLocaleTimeString('ja-JP', { 
      hour: '2-digit', 
      minute: '2-digit', 
      second: '2-digit' 
    });
  };
  
  if (logs.length === 0) {
    return (
      <div className="h-64 bg-gray-900 rounded-lg flex items-center justify-center">
        <span className="text-gray-500">ãƒ­ã‚°ã‚’å¾…æ©Ÿä¸­...</span>
      </div>
    );
  }
  
  return (
    <div
      ref={containerRef}
      className="h-64 bg-gray-900 rounded-lg p-3 overflow-y-auto font-mono text-sm"
    >
      {logs.map((log, index) => (
        <div key={index} className="mb-1">
          <span className="text-gray-500">{formatTime(log.timestamp)}</span>
          <span className={`ml-2 ${getLevelColor(log.level)}`}>
            [{log.level}]
          </span>
          <span className="text-gray-300 ml-2">{log.message}</span>
        </div>
      ))}
    </div>
  );
}
```

---

## å®Ÿè£…æ‰‹é †ï¼ˆæ›´æ–°ç‰ˆï¼‰

### Phase 1: åŸºæœ¬æ§‹é€ 
1. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®FastAPIåŸºæœ¬æ§‹é€ ã‚’ä½œæˆ
2. SQLAlchemyãƒ¢ãƒ‡ãƒ«ã¨DBæ¥ç¶š
3. ã‚¿ã‚¹ã‚¯CRUD APIã®å®Ÿè£…
4. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®åŸºæœ¬ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
5. ã‚¿ã‚¹ã‚¯ä¸€è¦§è¡¨ç¤º

### Phase 2: èªè¨¼æƒ…å ±ç®¡ç†
1. æš—å·åŒ–ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆencryption.pyï¼‰
2. èªè¨¼æƒ…å ±ãƒ¢ãƒ‡ãƒ«ï¼ˆCredentialï¼‰
3. CredentialManager ã‚µãƒ¼ãƒ“ã‚¹
4. Credentials APIï¼ˆCRUD + ãƒ†ã‚¹ãƒˆï¼‰
5. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èªè¨¼æƒ…å ±ç®¡ç†UI

### Phase 3: ã‚¿ã‚¹ã‚¯ç®¡ç†
1. ã‚¿ã‚¹ã‚¯ä½œæˆãƒ»ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ 
2. ã‚¿ã‚¹ã‚¯ã¨èªè¨¼æƒ…å ±ã®é–¢é€£ä»˜ã‘
3. æœ‰åŠ¹/ç„¡åŠ¹ãƒˆã‚°ãƒ«

### Phase 4: å®Ÿè¡Œæ©Ÿèƒ½ + ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼åŸºç›¤
1. Browser Useã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚µãƒ¼ãƒ“ã‚¹ï¼ˆLiveViewAgentï¼‰
2. BrowserControllerï¼ˆä¸€æ™‚åœæ­¢ãƒ»åœæ­¢åˆ¶å¾¡ï¼‰
3. LiveViewManagerï¼ˆWebSocketé…ä¿¡ï¼‰
4. å®Ÿè¡Œå±¥æ­´ã®ä¿å­˜

### Phase 5: ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼UI
1. WebSocketãƒ•ãƒƒã‚¯ï¼ˆuseLiveViewï¼‰
2. ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼ã‚¹ãƒˆã‚¢ï¼ˆliveViewStoreï¼‰
3. StepProgress ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
4. ScreenshotViewer ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
5. ControlPanel ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
6. LogStream ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
7. LiveView ãƒšãƒ¼ã‚¸

### Phase 6: ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ©Ÿèƒ½
1. APSchedulerã‚µãƒ¼ãƒ“ã‚¹
2. cronå¼ã®ãƒ‘ãƒ¼ã‚¹ã¨ç™»éŒ²
3. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¨ãƒ‡ã‚£ã‚¿UI

### Phase 7: å‹•ç”»åˆ†æ + ãƒ’ã‚¢ãƒªãƒ³ã‚°æ©Ÿèƒ½
1. å‹•ç”»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰API
2. Gemini APIé€£æº
3. ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
4. ã‚¿ã‚¹ã‚¯è‡ªå‹•ç”Ÿæˆ

### Phase 8: é€šçŸ¥æ©Ÿèƒ½
1. Slacké€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹
2. ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹

### Phase 9: ãƒ‡ãƒ—ãƒ­ã‚¤
1. Dockerfileã®æœ€çµ‚èª¿æ•´
2. Hetzner VPS + Coolifyã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
3. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

---

## Dockerfileã®æ³¨æ„ç‚¹

```dockerfile
FROM python:3.11-slim

# Playwrightã®ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN apt-get update && apt-get install -y \
    wget \
    gnupg \
    libglib2.0-0 \
    libnss3 \
    libnspr4 \
    libatk1.0-0 \
    libatk-bridge2.0-0 \
    libcups2 \
    libdrm2 \
    libdbus-1-3 \
    libxcb1 \
    libxkbcommon0 \
    libx11-6 \
    libxcomposite1 \
    libxdamage1 \
    libxext6 \
    libxfixes3 \
    libxrandr2 \
    libgbm1 \
    libpango-1.0-0 \
    libcairo2 \
    libasound2 \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Playwrightãƒ–ãƒ©ã‚¦ã‚¶ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN playwright install chromium

COPY . .

# ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆä¿å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
RUN mkdir -p screenshots uploads

ENV IN_DOCKER=True
ENV PYTHONUNBUFFERED=1

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

---

## docker-compose.ymlï¼ˆshm_sizeè¨­å®šï¼‰

```yaml
version: '3.8'

services:
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=sqlite:///./data/workflow.db
      - ENCRYPTION_KEY=${ENCRYPTION_KEY}
      - IN_DOCKER=True
    volumes:
      - ./data:/app/data
      - ./screenshots:/app/screenshots
    shm_size: '1gb'  # é‡è¦: Chromiumã®ãƒ¡ãƒ¢ãƒªå•é¡Œã‚’å›é¿
    init: true       # é‡è¦: ã‚¾ãƒ³ãƒ“ãƒ—ãƒ­ã‚»ã‚¹é˜²æ­¢
    restart: unless-stopped

  frontend:
    build: ./frontend
    ports:
      - "3000:80"
    depends_on:
      - backend
    restart: unless-stopped
```

---

## æ³¨æ„äº‹é …

1. **Browser Useã¯headless=Trueã§å‹•ä½œã•ã›ã‚‹**
2. **shm_size: '1gb'ã‚’Dockerè¨­å®šã«å¿…ãšè¿½åŠ **ï¼ˆChromiumã‚¯ãƒ©ãƒƒã‚·ãƒ¥é˜²æ­¢ï¼‰
3. **init: trueã§ã‚¾ãƒ³ãƒ“ãƒ—ãƒ­ã‚»ã‚¹ã‚’é˜²æ­¢**
4. **SQLiteãƒ•ã‚¡ã‚¤ãƒ«ã¯æ°¸ç¶šåŒ–ãƒœãƒªãƒ¥ãƒ¼ãƒ ã«ä¿å­˜**
5. **WebSocketã¯å†æ¥ç¶šãƒ­ã‚¸ãƒƒã‚¯ã‚’å¿…ãšå®Ÿè£…**
6. **ENCRYPTION_KEYã¯æœ¬ç•ªç’°å¢ƒã§å¿…ãšãƒ©ãƒ³ãƒ€ãƒ ãªå€¤ã«å¤‰æ›´**
7. **ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã¯å®šæœŸçš„ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**ï¼ˆãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡æ³¨æ„ï¼‰
8. **ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼ã®WebSocketã¯é«˜é »åº¦æ›´æ–°ã«ãªã‚‹ãŸã‚ã€å¿…è¦ã«å¿œã˜ã¦ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°**
9. **ä¸€æ™‚åœæ­¢ä¸­ã¯APIè²»ç”¨ãŒç™ºç”Ÿã—ç¶šã‘ã‚‹ãŸã‚ã€é•·æ™‚é–“æ”¾ç½®ã«æ³¨æ„**

---

## æœˆé¡ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Šï¼ˆHetzner + Coolifyï¼‰

| é …ç›® | ã‚³ã‚¹ãƒˆ |
|------|--------|
| Hetzner CX32 (8GB RAM) | ~$7.40 |
| Claude API (10ã‚¿ã‚¹ã‚¯/æ—¥æƒ³å®š) | ~$10-20 |
| Gemini API (å‹•ç”»åˆ†æ) | ~$5-10 |
| **åˆè¨ˆ** | **~$22-37/æœˆ** |

Zeaburã®$48ã€œ50/æœˆã¨æ¯”è¼ƒã—ã¦ã€ç´„åŠé¡ã§åŒç­‰ä»¥ä¸Šã®æ©Ÿèƒ½ãŒå®Ÿç¾ã§ãã¾ã™ã€‚
